# 0.5 Networking - Hands-On Learning

> Learn networking by DOING - practical exercises with your kind cluster

---

## Learning Philosophy

```text
┌─────────────────────────────────────────────────────────────────┐
│              LEARN BY DOING                                     │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   Theory is boring. Let's BREAK things to understand them!      │
│                                                                 │
│   For each concept:                                             │
│   1. See it in action first                                     │
│   2. Break it on purpose                                        │
│   3. Fix it yourself                                            │
│   4. Now you truly understand it                                │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## Prerequisites

- Completed [0.7 First Cluster](../0.7_first_cluster.md) - your kind cluster is running
- Basic terminal skills
- `kubectl get nodes` shows your cluster nodes

---

## The Networking Journey

```text
┌─────────────────────────────────────────────────────────────────┐
│              YOUR LEARNING PATH                                 │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   Level 1: Your Mac's Network                                   │
│   ├── See your IP addresses (ifconfig)                          │
│   ├── Watch live connections (netstat)                          │
│   └── DNS lookups (dig, nslookup)                               │
│                                                                 │
│   Level 2: Container Networking                                 │
│   ├── How containers get IPs                                    │
│   ├── Container-to-container communication                      │
│   └── Port mapping basics                                       │
│                                                                 │
│   Level 3: Kubernetes Pod Networking                            │
│   ├── Pod IPs and the CNI                                       │
│   ├── Pod-to-Pod communication                                  │
│   └── Same node vs cross-node traffic                           │
│                                                                 │
│   Level 4: Kubernetes Services                                  │
│   ├── ClusterIP - internal load balancing                       │
│   ├── NodePort - external access                                │
│   └── How kube-proxy makes it work                              │
│                                                                 │
│   Level 5: DNS in Kubernetes                                    │
│   ├── CoreDNS and service discovery                             │
│   ├── Resolving service names                                   │
│   └── Debugging DNS issues                                      │
│                                                                 │
│   Level 6: Network Policies                                     │
│   ├── Default "allow all" behavior                              │
│   ├── Creating ingress/egress rules                             │
│   └── Isolating namespaces                                      │
│                                                                 │
│   Level 7: Ingress & External Access                            │
│   ├── Ingress controllers                                       │
│   ├── Path-based routing                                        │
│   └── TLS termination                                           │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## Hands-On Labs

### Lab 1: Explore Your Mac's Network (15 min)

**Objective:** Understand basic networking commands before diving into K8s

```bash
# See all your network interfaces and IPs
ifconfig

# See only IP addresses
ifconfig | grep "inet "

# Watch active connections in real-time
netstat -an | grep ESTABLISHED

# Find who you're connected to (reverse DNS)
dig -x <ip-address>

# Check your DNS servers
scutil --dns | grep "nameserver"

# Trace the route to google
traceroute google.com
```

**Challenge:** Find the IP address of github.com and verify it with reverse DNS.

---

### Lab 2: Pod Networking Basics (20 min)

**Objective:** See how pods get IPs and communicate

```bash
# Deploy two pods
kubectl run pod1 --image=nginx --restart=Never
kubectl run pod2 --image=busybox --restart=Never --command -- sleep 3600

# Wait for pods to be ready
kubectl get pods -o wide

# Note the IPs - they're from your cluster's pod CIDR!
# In kind, typically 10.244.x.x

# Exec into pod2 and ping pod1
kubectl exec -it pod2 -- ping <pod1-ip> -c 3

# Exec into pod2 and curl pod1's nginx
kubectl exec -it pod2 -- wget -qO- <pod1-ip>
```

**What you learned:**
- Each pod gets a unique IP
- Pods can reach each other directly by IP
- No NAT needed within the cluster

**Cleanup:**
```bash
kubectl delete pod pod1 pod2
```

---

### Lab 3: Services - ClusterIP (25 min)

**Objective:** Understand how Services provide stable IPs for pods

```bash
# Create a deployment (3 replicas)
kubectl create deployment web --image=nginx --replicas=3

# Expose it with a ClusterIP service
kubectl expose deployment web --port=80

# See the service
kubectl get svc web

# Note: ClusterIP is from the service CIDR (typically 10.96.x.x)

# Create a test pod to access the service
kubectl run test --image=busybox --restart=Never --command -- sleep 3600

# Access service by IP
kubectl exec -it test -- wget -qO- <clusterip>

# Access service by DNS name (the magic!)
kubectl exec -it test -- wget -qO- web

# Watch load balancing - run multiple times
kubectl exec -it test -- sh -c 'for i in 1 2 3 4 5; do wget -qO- web 2>/dev/null | head -1; done'
```

**Break it on purpose:**
```bash
# Scale down to 0 replicas
kubectl scale deployment web --replicas=0

# Try to access - what happens?
kubectl exec -it test -- wget -qO- web --timeout=3
# Connection refused! No backends.

# Scale back up
kubectl scale deployment web --replicas=3
```

**Cleanup:**
```bash
kubectl delete deployment web
kubectl delete svc web
kubectl delete pod test
```

---

### Lab 4: NodePort - External Access (20 min)

**Objective:** Access your services from outside the cluster

```bash
# Create deployment
kubectl create deployment web --image=nginx

# Expose with NodePort
kubectl expose deployment web --port=80 --type=NodePort

# Find the NodePort
kubectl get svc web
# Look for port like 80:30XXX/TCP

# In kind, we need to find the node IP
kubectl get nodes -o wide
# Note the INTERNAL-IP

# Access from your Mac (kind specific)
# First, let's use port-forward for simplicity
kubectl port-forward svc/web 8080:80

# In another terminal
curl localhost:8080
```

**Cleanup:**
```bash
kubectl delete deployment web
kubectl delete svc web
```

---

### Lab 5: DNS Deep Dive (25 min)

**Objective:** Understand Kubernetes DNS and service discovery

```bash
# Create a deployment and service
kubectl create deployment web --image=nginx
kubectl expose deployment web --port=80

# Create test pod with DNS tools
kubectl run dnstest --image=busybox:1.36 --restart=Never --command -- sleep 3600

# Check what DNS server pods use
kubectl exec -it dnstest -- cat /etc/resolv.conf
# You'll see the CoreDNS ClusterIP (usually 10.96.0.10)

# Resolve service name
kubectl exec -it dnstest -- nslookup web
kubectl exec -it dnstest -- nslookup web.default.svc.cluster.local

# Try resolving a service in kube-system namespace
kubectl exec -it dnstest -- nslookup kubernetes.default

# Resolve external domains (yes, this works too!)
kubectl exec -it dnstest -- nslookup google.com
```

**See CoreDNS:**
```bash
# CoreDNS runs as pods in kube-system
kubectl get pods -n kube-system -l k8s-app=kube-dns

# See CoreDNS config
kubectl get configmap coredns -n kube-system -o yaml
```

**Cleanup:**
```bash
kubectl delete deployment web
kubectl delete svc web
kubectl delete pod dnstest
```

---

### Lab 6: Network Policies (30 min)

**Objective:** Control traffic between pods

```bash
# Create two namespaces
kubectl create namespace frontend
kubectl create namespace backend

# Deploy apps
kubectl run frontend --image=nginx -n frontend
kubectl run backend --image=nginx -n backend

# Expose backend
kubectl expose pod backend --port=80 -n backend

# Test connectivity (should work)
kubectl exec -it frontend -n frontend -- wget -qO- backend.backend.svc.cluster.local --timeout=3

# Now apply a network policy to block all ingress to backend namespace
cat <<EOF | kubectl apply -f -
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: deny-all-ingress
  namespace: backend
spec:
  podSelector: {}
  policyTypes:
  - Ingress
EOF

# Test again (should FAIL now - timeout)
kubectl exec -it frontend -n frontend -- wget -qO- backend.backend.svc.cluster.local --timeout=3

# Allow only from frontend namespace
cat <<EOF | kubectl apply -f -
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-frontend
  namespace: backend
spec:
  podSelector: {}
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          kubernetes.io/metadata.name: frontend
  policyTypes:
  - Ingress
EOF

# Test again (should work now!)
kubectl exec -it frontend -n frontend -- wget -qO- backend.backend.svc.cluster.local --timeout=3
```

**Cleanup:**
```bash
kubectl delete namespace frontend backend
```

---

## Reference Materials

These files provide detailed explanations of the concepts you'll practice:

| File | Topic |
|------|-------|
| [0.5_networking_basics.md](./0.5_networking_basics.md) | Ports, IPs, DNS fundamentals |
| [0.5.1_nat_explained.md](./0.5.1_nat_explained.md) | NAT, SNAT, DNAT, PAT |
| [0.5.2_dhcp_cidr_explained.md](./0.5.2_dhcp_cidr_explained.md) | DHCP, CIDR notation, IP allocation |

---

## Quick Command Reference

### Debugging Network Issues

```bash
# See pod IPs
kubectl get pods -o wide

# See service endpoints
kubectl get endpoints <service-name>

# Check if DNS is working
kubectl exec -it <pod> -- nslookup <service-name>

# Check connectivity
kubectl exec -it <pod> -- wget -qO- <service-name> --timeout=5

# See network policies
kubectl get networkpolicies -A

# Check CoreDNS logs
kubectl logs -n kube-system -l k8s-app=kube-dns

# Port forward for local testing
kubectl port-forward svc/<service> <local-port>:<service-port>
```

### Common Networking Objects

```text
┌─────────────────────────────────────────────────────────────────┐
│              KUBERNETES NETWORKING OBJECTS                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   Pod          → Gets unique IP, basic networking unit          │
│   Service      → Stable IP + DNS name, load balances to pods    │
│   Endpoints    → Tracks which pod IPs back a service            │
│   NetworkPolicy→ Firewall rules between pods                    │
│   Ingress      → HTTP/HTTPS routing from outside cluster        │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## Troubleshooting Checklist

When networking doesn't work:

```text
1. Can the pod reach itself?
   kubectl exec -it <pod> -- wget -qO- localhost:<port>

2. Can pods reach each other by IP?
   kubectl exec -it <pod> -- ping <other-pod-ip>

3. Is the service configured correctly?
   kubectl get endpoints <service>  # Should show pod IPs

4. Is DNS working?
   kubectl exec -it <pod> -- nslookup <service-name>

5. Is there a NetworkPolicy blocking traffic?
   kubectl get networkpolicies -n <namespace>

6. Is the application actually listening?
   kubectl exec -it <pod> -- netstat -tlnp
```

---

## What's Next?

After completing these labs:
- [0.6 Storage](../0.6_storage/) - Persistent data in Kubernetes
- Or continue exploring networking with Ingress controllers

---

## Sources

This curriculum was designed based on:
- [Kubernetes Networking Tutorial - freeCodeCamp](https://www.freecodecamp.org/news/kubernetes-networking-tutorial-for-developers/)
- [Kubernetes Practical Exercises - GitHub](https://github.com/seifrajhi/Kubernetes-practical-exercises-Hands-on)
- [Kubernetes Networking Guide - Spacelift](https://spacelift.io/blog/kubernetes-networking)
- [Kubernetes Networking Fundamentals - Opensource.com](https://opensource.com/article/22/6/kubernetes-networking-fundamentals)
- [Top 28 Kubernetes Resources 2026 - CNCF](https://www.cncf.io/blog/2026/01/19/top-28-kubernetes-resources-for-2026-learn-and-stay-up-to-date/)

---

**Start with:** [Lab 1: Explore Your Mac's Network](#lab-1-explore-your-macs-network-15-min)
