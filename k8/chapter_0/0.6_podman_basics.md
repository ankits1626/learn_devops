# 0.6 Podman Basics

> Understanding Podman before we use it for Kubernetes

---

## What is Podman?

Podman is a container engine - software that runs containers on your machine. It's the free, open-source alternative to Docker.

```text
┌─────────────────────────────────────────────────────────────────┐
│                    CONTAINER ENGINES                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   Docker                          Podman                        │
│   ┌─────────────────────┐        ┌─────────────────────┐        │
│   │  Industry standard  │        │  Free alternative   │        │
│   │  Paid for business  │        │  100% open source   │        │
│   │  Requires daemon    │        │  Daemonless         │        │
│   │  Runs as root       │        │  Rootless default   │        │
│   └─────────────────────┘        └─────────────────────┘        │
│                                                                 │
│   Same commands: docker run = podman run                        │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## What is a Daemon?

A **daemon** is a background process that runs continuously, waiting to handle requests.

```text
┌─────────────────────────────────────────────────────────────────┐
│                    DAEMON vs DAEMONLESS                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   DOCKER (uses a daemon)                                        │
│   ┌─────────────────────────────────────────────────────────┐   │
│   │                                                         │   │
│   │   You ──▶ docker CLI ──▶ Docker Daemon ──▶ Containers   │   │
│   │                              │                          │   │
│   │                              │ (always running          │   │
│   │                              │  in background)          │   │
│   │                              │                          │   │
│   │   If daemon crashes, ALL containers stop!               │   │
│   │                                                         │   │
│   └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│   PODMAN (daemonless)                                           │
│   ┌─────────────────────────────────────────────────────────┐   │
│   │                                                         │   │
│   │   You ──▶ podman CLI ──────────────────▶ Containers     │   │
│   │                                                         │   │
│   │   No background process needed                          │   │
│   │   Each container is independent                         │   │
│   │   More secure (no single point of failure)              │   │
│   │                                                         │   │
│   └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### Why Daemonless is Better

| Aspect | Docker (Daemon) | Podman (Daemonless) |
|--------|-----------------|---------------------|
| Background process | Always running, uses resources | None needed |
| Single point of failure | Daemon crash kills all containers | Containers are independent |
| Security | Daemon runs as root | No privileged daemon |
| Startup | Must start daemon first | Just run commands |

---

## Rootful vs Rootless Mode

This is about **permissions** - who can run containers and with what privileges.

### Rootless Mode (Default)

Containers run without root (administrator) privileges.

```text
┌─────────────────────────────────────────────────────────────────┐
│                    ROOTLESS MODE                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   Your user account ──▶ Podman ──▶ Container                    │
│        │                              │                         │
│        │ No root access               │ Limited privileges      │
│        │                              │                         │
│                                                                 │
│   Benefits:                                                     │
│   ✓ More secure (can't damage system)                           │
│   ✓ No sudo required                                            │
│   ✓ Containers isolated from each other                         │
│                                                                 │
│   Limitations:                                                  │
│   ✗ Can't bind to ports < 1024 (like 80, 443)                   │
│   ✗ Limited networking options                                  │
│   ✗ Some features unavailable                                   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### Rootful Mode

Containers run with root privileges (like Docker).

```text
┌─────────────────────────────────────────────────────────────────┐
│                    ROOTFUL MODE                                 │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   Your user ──▶ Podman ──▶ Root privileges ──▶ Container        │
│                                   │                             │
│                                   │ Full system access          │
│                                                                 │
│   Benefits:                                                     │
│   ✓ Full networking capabilities                                │
│   ✓ Can bind to any port                                        │
│   ✓ Required for kind (Kubernetes)                              │
│   ✓ Docker compatibility                                        │
│                                                                 │
│   Limitations:                                                  │
│   ✗ Less secure (containers have more power)                    │
│   ✗ Mistakes can affect system                                  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### Why kind Needs Rootful Mode

kind creates "nodes" that are actually containers. These node-containers need to:
- Run their own containers inside (nested containers)
- Configure networking between nodes
- Bind to privileged ports

This requires rootful mode.

```text
┌─────────────────────────────────────────────────────────────────┐
│                                                                 │
│   Rootless mode:                                                │
│   ┌─────────────┐                                               │
│   │  Container  │  ← Can't create containers inside             │
│   └─────────────┘                                               │
│                                                                 │
│   Rootful mode:                                                 │
│   ┌─────────────────────────────────────────────┐               │
│   │  kind "Node" Container                      │               │
│   │   ┌─────────┐ ┌─────────┐ ┌─────────┐       │               │
│   │   │ nginx   │ │ your-app│ │ redis   │       │               │
│   │   └─────────┘ └─────────┘ └─────────┘       │               │
│   │   ↑ Containers inside a container!          │               │
│   └─────────────────────────────────────────────┘               │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## The Podman Machine

On Mac (and Windows), containers need Linux to run. Podman creates a lightweight Linux virtual machine called a "Podman machine."

```text
┌─────────────────────────────────────────────────────────────────┐
│                    YOUR MAC                                     │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   macOS (Darwin kernel - not Linux)                             │
│   ┌─────────────────────────────────────────────────────────┐   │
│   │                                                         │   │
│   │   Podman Machine (Linux VM)                             │   │
│   │   ┌─────────────────────────────────────────────────┐   │   │
│   │   │                                                 │   │   │
│   │   │   Linux kernel (Fedora CoreOS)                  │   │   │
│   │   │   ┌─────────┐ ┌─────────┐ ┌─────────┐           │   │   │
│   │   │   │Container│ │Container│ │Container│           │   │   │
│   │   │   └─────────┘ └─────────┘ └─────────┘           │   │   │
│   │   │                                                 │   │   │
│   │   └─────────────────────────────────────────────────┘   │   │
│   │                                                         │   │
│   └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│   You run: podman run nginx                                     │
│   Podman talks to the Linux VM, which runs the container        │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### Machine Commands

```bash
# Create a new machine
podman machine init

# Create with specific resources
podman machine init --cpus 4 --memory 4096 --disk-size 60

# Create in rootful mode (recommended for kind)
podman machine init --rootful

# Start the machine
podman machine start

# Stop the machine
podman machine stop

# See machine status
podman machine list

# Delete the machine (removes all containers!)
podman machine rm

# SSH into the machine (advanced)
podman machine ssh
```

---

## Podman Desktop - The GUI

Yes! Podman has a desktop application similar to Docker Desktop.

### Podman Desktop

```text
┌─────────────────────────────────────────────────────────────────┐
│                    PODMAN DESKTOP                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   A graphical interface for Podman that provides:               │
│                                                                 │
│   • Visual container management                                 │
│   • Image browsing and pulling                                  │
│   • Pod management                                              │
│   • Kubernetes integration                                      │
│   • kind cluster creation (built-in!)                           │
│   • Machine management                                          │
│   • Extension support                                           │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### Install Podman Desktop

```bash
brew install --cask podman-desktop
```

Or download from: https://podman-desktop.io

### What Podman Desktop Looks Like

```text
┌─────────────────────────────────────────────────────────────────┐
│  Podman Desktop                                        [─][□][×]│
├──────────────┬──────────────────────────────────────────────────┤
│              │                                                  │
│  Dashboard   │   Containers (3 running)                         │
│              │   ┌────────────────────────────────────────────┐ │
│  Containers  │   │ nginx        Running    8080:80   Stop  ⋮  │ │
│              │   │ redis        Running    6379      Stop  ⋮  │ │
│  Pods        │   │ my-app       Running    3000      Stop  ⋮  │ │
│              │   └────────────────────────────────────────────┘ │
│  Images      │                                                  │
│              │   Images (5 available)                           │
│  Volumes     │   ┌────────────────────────────────────────────┐ │
│              │   │ nginx:latest           25MB                │ │
│  Kubernetes  │   │ redis:alpine           15MB                │ │
│              │   │ node:20-alpine         50MB                │ │
│  Settings    │   └────────────────────────────────────────────┘ │
│              │                                                  │
└──────────────┴──────────────────────────────────────────────────┘
```

### Podman Desktop Features for Kubernetes

Podman Desktop can:

1. **Create kind clusters** directly from the UI
2. **Switch between clusters** easily
3. **View Kubernetes resources** (pods, deployments, services)
4. **Manage kubeconfig** contexts

```text
┌─────────────────────────────────────────────────────────────────┐
│  Podman Desktop - Kubernetes                                    │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Clusters                                                       │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ ● kind-playground    (current)              Delete      │   │
│  │ ○ minikube           (stopped)              Start       │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  [+ Create kind cluster]                                        │
│                                                                 │
│  Resources (kind-playground)                                    │
│  ├── Pods (15)                                                  │
│  ├── Deployments (3)                                            │
│  ├── Services (5)                                               │
│  └── ConfigMaps (8)                                             │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## Podman vs Docker: Quick Comparison

| Feature | Docker | Podman |
|---------|--------|--------|
| **License** | Free for personal, paid for business | 100% free and open source |
| **Architecture** | Daemon-based | Daemonless |
| **Default mode** | Rootful | Rootless |
| **Commands** | `docker ...` | `podman ...` (identical!) |
| **Desktop GUI** | Docker Desktop | Podman Desktop |
| **Pod support** | No native pods | Native pod support (like K8s) |
| **Compose** | docker-compose | podman-compose |
| **Mac/Windows** | Linux VM | Linux VM (same approach) |
| **Kind support** | Native | Requires rootful mode |

---

## Essential Podman Commands

```bash
# Machine management (Mac/Windows only)
podman machine init              # Create a new machine
podman machine start             # Start the machine
podman machine stop              # Stop the machine
podman machine list              # List machines
podman machine rm                # Delete machine

# Container basics
podman run nginx                 # Run a container
podman run -d nginx              # Run in background (detached)
podman run -d -p 8080:80 nginx   # Run with port mapping
podman ps                        # List running containers
podman ps -a                     # List all containers
podman stop <id>                 # Stop a container
podman rm <id>                   # Remove a container
podman rm -f <id>                # Force remove (stop + remove)

# Images
podman images                    # List images
podman pull nginx                # Download an image
podman rmi nginx                 # Remove an image
podman build -t myapp .          # Build image from Dockerfile

# Debugging
podman logs <id>                 # View container logs
podman logs -f <id>              # Follow logs
podman exec -it <id> sh          # Shell into container
podman inspect <id>              # Detailed container info

# System
podman info                      # System information
podman system prune              # Clean up unused resources
```

---

## Setting Up for This Course

For our Kubernetes course, we need:

```bash
# 1. Install Podman
brew install podman

# 2. Create a rootful machine with adequate resources
podman machine init --rootful --cpus 4 --memory 4096 --disk-size 60

# 3. Start the machine
podman machine start

# 4. Verify it's running and rootful
podman machine list
podman machine inspect | grep -i rootful
# Should show: "Rootful": true

# 5. Set the environment variable for kind
echo 'export KIND_EXPERIMENTAL_PROVIDER=podman' >> ~/.zshrc
source ~/.zshrc
```

---

## Quick Reference

```text
┌─────────────────────────────────────────────────────────────────┐
│                    PODMAN QUICK REFERENCE                       │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   Daemon:     Background process that handles requests          │
│   Daemonless: No background process needed (Podman's approach)  │
│                                                                 │
│   Rootless:   Containers run without admin privileges           │
│               (default, more secure, some limitations)          │
│                                                                 │
│   Rootful:    Containers run with admin privileges              │
│               (needed for kind, full networking)                │
│                                                                 │
│   Machine:    Linux VM that runs on Mac/Windows                 │
│               (containers need Linux)                           │
│                                                                 │
│   Podman Desktop: GUI for managing containers and Kubernetes    │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

**Next:** [0.6 Mac Setup](./0.6_mac_setup.md) - Install all the tools for Kubernetes
