# 0.7 Your First Cluster

> **Last validated:** January 2026 | kind v0.31.0 | Kubernetes v1.31+

## Goal

Create a 3-node Kubernetes cluster on your Mac and verify it's working. By the end, you'll have a real cluster running locally.

---

## What We're Building

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    YOUR LOCAL CLUSTER                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚              Control Plane Node                         â”‚   â”‚
â”‚   â”‚         (playground-control-plane)                      â”‚   â”‚
â”‚   â”‚                                                         â”‚   â”‚
â”‚   â”‚   API Server, Scheduler, Controller Manager, etcd       â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â”‚                                      â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚              â–¼                       â–¼                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚   â”‚    Worker Node 1    â”‚ â”‚    Worker Node 2    â”‚               â”‚
â”‚   â”‚ (playground-worker) â”‚ â”‚ (playground-worker2)â”‚               â”‚
â”‚   â”‚                     â”‚ â”‚                     â”‚               â”‚
â”‚   â”‚  Your pods run here â”‚ â”‚  Your pods run here â”‚               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                 â”‚
â”‚   3 Podman containers = 3 Kubernetes nodes = 1 cluster          â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Step 1: Create a Playground Directory

Let's organize our K8s learning in one place:

```bash
# Create the playground directory
mkdir -p ~/k8s-playground
cd ~/k8s-playground
```

This will grow as we progress through chapters:

```text
~/k8s-playground/
â”œâ”€â”€ kind-config.yaml        # Cluster configuration (Chapter 0)
â”œâ”€â”€ pods/                   # Pod manifests (Chapter 1)
â”œâ”€â”€ deployments/            # Deployment manifests (Chapter 2)
â”œâ”€â”€ services/               # Service manifests (Chapter 3)
â””â”€â”€ ...
```

---

## Step 2: Create the Cluster Configuration

Create a file that tells kind what kind of cluster to create:

```bash
# Create the config file
cat > kind-config.yaml << 'EOF'
# kind-config.yaml
# Configuration for a 3-node Kubernetes cluster

kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4

nodes:
  # Control plane node (the brain)
  - role: control-plane
    # Expose ports for accessing services later
    extraPortMappings:
      - containerPort: 30000
        hostPort: 30000
        protocol: TCP
      - containerPort: 30001
        hostPort: 30001
        protocol: TCP

  # Worker node 1 (runs your containers)
  - role: worker

  # Worker node 2 (runs your containers)
  - role: worker
EOF
```

**What this does:**
- Creates 1 control plane node (runs K8s brain components)
- Creates 2 worker nodes (where your apps will run)
- Maps some ports so you can access services from your browser

---

## Step 3: Create the Cluster

This is the exciting part - we're creating a real Kubernetes cluster!

```bash
# Make sure Podman is running
podman machine start

# Verify Podman is in rootful mode (required for kind)
podman machine inspect | grep -i rootful
# Should show: "Rootful": true

# Create the cluster (this takes 1-3 minutes)
# The --wait flag ensures all nodes are ready before returning
kind create cluster --name playground --config kind-config.yaml --wait 60s
```

You'll see output like:

```text
Creating cluster "playground" ...
 âœ“ Ensuring node image (kindest/node:v1.31.0) ğŸ–¼
 âœ“ Preparing nodes ğŸ“¦ ğŸ“¦ ğŸ“¦
 âœ“ Writing configuration ğŸ“œ
 âœ“ Starting control-plane ğŸ•¹ï¸
 âœ“ Installing CNI ğŸ”Œ
 âœ“ Installing StorageClass ğŸ’¾
 âœ“ Joining worker nodes ğŸšœ
Set kubectl context to "kind-playground"
You can now use your cluster with:

kubectl cluster-info --context kind-playground

Have a nice day! ğŸ‘‹
```

---

## Step 4: Verify the Cluster

**Check the nodes:**

```bash
kubectl get nodes
```

Expected output:

```text
NAME                       STATUS   ROLES           AGE   VERSION
playground-control-plane   Ready    control-plane   2m    v1.31.0
playground-worker          Ready    <none>          90s   v1.31.0
playground-worker2         Ready    <none>          90s   v1.31.0
```

**All 3 nodes should show `Ready` status.**

**See more details:**

```bash
kubectl get nodes -o wide
```

This shows additional info like IP addresses and container runtime.

---

## Step 5: See What's Running

Kubernetes runs some system pods by default. Let's see them:

```bash
# See all pods in all namespaces
kubectl get pods -A
```

Expected output:

```text
NAMESPACE            NAME                                               READY   STATUS    RESTARTS   AGE
kube-system          coredns-6f6b679f8f-abcde                          1/1     Running   0          3m
kube-system          coredns-6f6b679f8f-fghij                          1/1     Running   0          3m
kube-system          etcd-playground-control-plane                      1/1     Running   0          3m
kube-system          kindnet-xxxxx                                      1/1     Running   0          3m
kube-system          kindnet-yyyyy                                      1/1     Running   0          3m
kube-system          kindnet-zzzzz                                      1/1     Running   0          3m
kube-system          kube-apiserver-playground-control-plane            1/1     Running   0          3m
kube-system          kube-controller-manager-playground-control-plane   1/1     Running   0          3m
kube-system          kube-proxy-xxxxx                                   1/1     Running   0          3m
kube-system          kube-proxy-yyyyy                                   1/1     Running   0          3m
kube-system          kube-proxy-zzzzz                                   1/1     Running   0          3m
kube-system          kube-scheduler-playground-control-plane            1/1     Running   0          3m
local-path-storage   local-path-provisioner-xxxxxxxxxx-xxxxx            1/1     Running   0          3m
```

**Look! You can see the architecture in action:**
- `etcd` - the database
- `kube-apiserver` - the API server
- `kube-controller-manager` - the controller manager
- `kube-scheduler` - the scheduler
- `coredns` - DNS for the cluster
- `kindnet` - networking (one per node)
- `kube-proxy` - networking rules (one per node)

---

## Step 6: Run Your First Pod

Let's run something ourselves:

```bash
# Run an nginx pod
kubectl run my-first-pod --image=nginx

# Check it's running
kubectl get pods
```

Expected output:

```text
NAME           READY   STATUS    RESTARTS   AGE
my-first-pod   1/1     Running   0          30s
```

**Congratulations! You just deployed your first container to Kubernetes!**

**See which node it's running on:**

```bash
kubectl get pods -o wide
```

```text
NAME           READY   STATUS    RESTARTS   AGE   IP           NODE
my-first-pod   1/1     Running   0          1m    10.244.1.2   playground-worker
```

The scheduler automatically picked a worker node for your pod.

---

## Step 7: Explore with k9s (Optional)

If you installed k9s, try it out:

```bash
k9s
```

This opens a terminal UI where you can:
- See all pods (press `0` for all namespaces)
- See logs (select pod, press `l`)
- Shell into a pod (select pod, press `s`)
- Delete a pod (select pod, press `ctrl+d`)

Press `ctrl+c` or `:quit` to exit.

---

## Step 8: Clean Up the Test Pod

```bash
# Delete the pod we created
kubectl delete pod my-first-pod

# Verify it's gone
kubectl get pods
```

---

## Understanding What Happened

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    WHAT JUST HAPPENED                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   You ran: kubectl run my-first-pod --image=nginx               â”‚
â”‚                                                                 â”‚
â”‚   1. kubectl sent request to API Server                         â”‚
â”‚                              â”‚                                  â”‚
â”‚   2. API Server stored pod   â”‚                                  â”‚
â”‚      spec in etcd            â–¼                                  â”‚
â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚   3. Scheduler saw     â”‚ Schedulerâ”‚                             â”‚
â”‚      unscheduled pod   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                              â”‚                                  â”‚
â”‚   4. Scheduler picked        â”‚ "Put on worker node 1"           â”‚
â”‚      best node               â–¼                                  â”‚
â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚   5. kubelet on that   â”‚ kubelet  â”‚                             â”‚
â”‚      node saw the pod  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                              â”‚                                  â”‚
â”‚   6. kubelet told            â”‚                                  â”‚
â”‚      container runtime       â–¼                                  â”‚
â”‚      to start nginx    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚                        â”‚Container â”‚                             â”‚
â”‚   7. nginx is running! â”‚ Runtime  â”‚                             â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Cluster Management Commands

```bash
# See cluster info
kubectl cluster-info

# See current context (which cluster you're connected to)
kubectl config current-context

# List all clusters kind knows about
kind get clusters

# Delete the cluster (when you're done for the day)
kind delete cluster --name playground

# Recreate it later
kind create cluster --name playground --config kind-config.yaml
```

---

## Daily Workflow

```bash
# Start of day - make sure Podman is running
podman machine start

# Check if cluster exists
kind get clusters

# If cluster exists, verify it's working
kubectl get nodes

# If not, create it
cd ~/k8s-playground
kind create cluster --name playground --config kind-config.yaml --wait 60s

# End of day - you have two options:

# Option 1: Stop Podman (cluster persists, just not accessible)
podman machine stop

# Option 2: Delete cluster to free resources, then stop Podman
kind delete cluster --name playground
podman machine stop
```

**Note:** Your cluster state persists when you stop Podman - just start it again with `podman machine start` and your cluster should be there. However, if you delete and recreate the Podman machine, you'll need to recreate the cluster. The `kind-config.yaml` file lets you recreate it quickly.

---

## Troubleshooting

### "Cannot connect to cluster"

```bash
# Check Podman is running
podman machine list

# Check cluster exists
kind get clusters

# Check kubectl context
kubectl config current-context
```

### Nodes show "NotReady"

Wait a minute - they're probably still starting. If still not ready:

```bash
# Delete and recreate
kind delete cluster --name playground
kind create cluster --name playground --config kind-config.yaml
```

### "Error: failed to create cluster"

```bash
# Make sure Podman is in rootful mode
podman machine stop
podman machine set --rootful
podman machine start

# Try again
kind create cluster --name playground --config kind-config.yaml --wait 60s
```

### Cluster creation hangs or times out

```bash
# Delete any partial cluster
kind delete cluster --name playground

# Check Podman machine has enough resources
podman machine inspect | grep -E "(CPUs|Memory|DiskSize)"
# Recommended: 4 CPUs, 4GB memory minimum

# If resources are low, recreate the machine
podman machine stop
podman machine rm
podman machine init --rootful --cpus 4 --memory 4096 --disk-size 60
podman machine start

# Try cluster creation again
kind create cluster --name playground --config kind-config.yaml --wait 120s
```

### Images fail to pull inside cluster

```bash
# Verify internet connectivity from Podman
podman run --rm alpine ping -c 2 google.com

# If DNS issues, check /etc/resolv.conf in Podman machine
podman machine ssh cat /etc/resolv.conf
```

---

## What You've Accomplished

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                 â”‚
â”‚   âœ“ Created a 3-node Kubernetes cluster                        â”‚
â”‚   âœ“ Verified all nodes are Ready                                â”‚
â”‚   âœ“ Saw the Control Plane components running as pods           â”‚
â”‚   âœ“ Deployed your first container (nginx)                      â”‚
â”‚   âœ“ Understood the flow from kubectl to running container      â”‚
â”‚                                                                 â”‚
â”‚   You now have a real Kubernetes environment to learn with!    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Checklist

Before moving on:

- [ ] `kubectl get nodes` shows 3 Ready nodes
- [ ] `kubectl get pods -A` shows system pods running
- [ ] You successfully ran `kubectl run my-first-pod --image=nginx`
- [ ] You deleted the test pod with `kubectl delete pod my-first-pod`

---

**Next:** Now that you have a working cluster, you can revisit the architecture section and actually SEE the components running. Or continue to Chapter 1 to learn about Pods in depth!

- [0.2 Kubernetes Architecture](./0.2_k8s_architecture.md) - Now you can see it in action!
- Chapter 1 - Pods (The Building Blocks)
