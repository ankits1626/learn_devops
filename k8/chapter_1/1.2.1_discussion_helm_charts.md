# Discussion: What is a Helm Chart?

> Helm = Package manager for Kubernetes

---

## The Analogy

```
┌─────────────────────────────────────────────────────────────────────────┐
│                    HELM: THE K8S PACKAGE MANAGER                         │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   OS Package Managers          Kubernetes                               │
│   ────────────────────         ──────────────────                       │
│   apt (Debian/Ubuntu)    →     Helm                                     │
│   brew (macOS)           →     Helm                                     │
│   npm (Node.js)          →     Helm                                     │
│                                                                         │
│   Package Format               Helm Format                              │
│   ────────────────────         ──────────────────                       │
│   .deb / .pkg / .rpm     →     Helm Chart                               │
│                                                                         │
│   Commands                     Helm Commands                            │
│   ────────────────────         ──────────────────                       │
│   apt install nginx      →     helm install nginx bitnami/nginx         │
│   apt upgrade nginx      →     helm upgrade nginx bitnami/nginx         │
│   apt remove nginx       →     helm uninstall nginx                     │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## The Problem Helm Solves

### Without Helm

Deploying a typical application requires many YAML files:

```
my-app/
├── deployment.yaml          # App deployment
├── service.yaml             # Network access
├── configmap.yaml           # Configuration
├── secret.yaml              # Credentials
├── ingress.yaml             # External access
├── serviceaccount.yaml      # Identity
├── hpa.yaml                 # Autoscaling
├── pdb.yaml                 # Disruption budget
└── networkpolicy.yaml       # Security
```

**Problems with raw YAML:**

| Problem | Example |
|---------|---------|
| **Repetition** | Same app in dev, staging, prod with minor differences |
| **No versioning** | Which version is deployed? How to rollback? |
| **Hard to share** | How do you distribute K8s configs? |
| **Manual updates** | Change image tag in 5 files? |
| **Dependencies** | App needs Redis, how to install both? |

---

## What a Helm Chart Is

A Helm Chart is a **directory of templated K8s manifests**:

```
my-chart/
├── Chart.yaml              # Metadata (name, version, description)
├── values.yaml             # Default configuration values
├── values-dev.yaml         # Dev environment overrides (optional)
├── values-prod.yaml        # Prod environment overrides (optional)
├── templates/              # Templated K8s manifests
│   ├── deployment.yaml
│   ├── service.yaml
│   ├── configmap.yaml
│   ├── ingress.yaml
│   ├── _helpers.tpl        # Template helpers
│   └── NOTES.txt           # Post-install message
├── charts/                 # Dependencies (sub-charts)
└── README.md               # Documentation
```

---

## How Helm Templating Works

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      HELM TEMPLATING FLOW                                │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   values.yaml                 templates/deployment.yaml                 │
│   ───────────────             ─────────────────────────                 │
│   replicaCount: 3             replicas: {{ .Values.replicaCount }}      │
│   image:                      image: {{ .Values.image.repository }}:    │
│     repository: nginx                {{ .Values.image.tag }}            │
│     tag: "1.25"                                                         │
│                                                                         │
│                     ┌─────────────────┐                                 │
│                     │   helm install  │                                 │
│                     │   or            │                                 │
│                     │   helm template │                                 │
│                     └────────┬────────┘                                 │
│                              │                                          │
│                              ▼                                          │
│                                                                         │
│                     Final deployment.yaml                               │
│                     ─────────────────────                               │
│                     replicas: 3                                         │
│                     image: nginx:1.25                                   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## Example: values.yaml

```yaml
# values.yaml - Default configuration
replicaCount: 2

image:
  repository: nginx
  tag: "1.25"
  pullPolicy: IfNotPresent

service:
  type: ClusterIP
  port: 80

ingress:
  enabled: false
  host: ""

resources:
  requests:
    cpu: 100m
    memory: 128Mi
  limits:
    cpu: 200m
    memory: 256Mi

env:
  LOG_LEVEL: "info"
```

---

## Example: templates/deployment.yaml

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ .Release.Name }}-{{ .Chart.Name }}
  labels:
    app: {{ .Chart.Name }}
    release: {{ .Release.Name }}
spec:
  replicas: {{ .Values.replicaCount }}
  selector:
    matchLabels:
      app: {{ .Chart.Name }}
      release: {{ .Release.Name }}
  template:
    metadata:
      labels:
        app: {{ .Chart.Name }}
        release: {{ .Release.Name }}
    spec:
      containers:
        - name: {{ .Chart.Name }}
          image: "{{ .Values.image.repository }}:{{ .Values.image.tag }}"
          imagePullPolicy: {{ .Values.image.pullPolicy }}
          ports:
            - containerPort: 80
          env:
            - name: LOG_LEVEL
              value: {{ .Values.env.LOG_LEVEL | quote }}
          resources:
            {{- toYaml .Values.resources | nindent 12 }}
```

---

## Installing with Different Values

```bash
# Install with defaults
helm install my-app ./my-chart

# Override single value
helm install my-app ./my-chart --set replicaCount=5

# Override multiple values
helm install my-app ./my-chart \
  --set replicaCount=5 \
  --set image.tag="1.26"

# Use different values file for production
helm install my-app ./my-chart -f values-prod.yaml

# Combine: base + environment + overrides
helm install my-app ./my-chart \
  -f values.yaml \
  -f values-prod.yaml \
  --set image.tag="1.26"
```

---

## Environment-Specific Values

```yaml
# values-dev.yaml
replicaCount: 1
resources:
  requests:
    cpu: 50m
    memory: 64Mi

# values-staging.yaml
replicaCount: 2
ingress:
  enabled: true
  host: staging.example.com

# values-prod.yaml
replicaCount: 5
resources:
  requests:
    cpu: 500m
    memory: 512Mi
  limits:
    cpu: 1000m
    memory: 1Gi
ingress:
  enabled: true
  host: www.example.com
```

---

## Helm Commands Cheatsheet

```bash
# ─────────────────────────────────────────────────────────────
# REPOSITORIES
# ─────────────────────────────────────────────────────────────
helm repo add bitnami https://charts.bitnami.com/bitnami
helm repo update
helm repo list
helm search repo nginx

# ─────────────────────────────────────────────────────────────
# INSTALLING
# ─────────────────────────────────────────────────────────────
helm install <release-name> <chart>
helm install my-nginx bitnami/nginx
helm install my-nginx bitnami/nginx --namespace web --create-namespace
helm install my-nginx ./local-chart -f custom-values.yaml

# ─────────────────────────────────────────────────────────────
# MANAGING RELEASES
# ─────────────────────────────────────────────────────────────
helm list                        # List installed releases
helm list -A                     # All namespaces
helm status my-nginx             # Release status
helm get values my-nginx         # Current values
helm get manifest my-nginx       # Rendered YAML

# ─────────────────────────────────────────────────────────────
# UPGRADING & ROLLBACK
# ─────────────────────────────────────────────────────────────
helm upgrade my-nginx bitnami/nginx --set replicaCount=5
helm history my-nginx            # Version history
helm rollback my-nginx 1         # Rollback to revision 1

# ─────────────────────────────────────────────────────────────
# UNINSTALLING
# ─────────────────────────────────────────────────────────────
helm uninstall my-nginx

# ─────────────────────────────────────────────────────────────
# DEBUGGING
# ─────────────────────────────────────────────────────────────
helm template my-nginx ./chart   # Render without installing
helm install my-nginx ./chart --dry-run --debug  # Test install
helm lint ./chart                # Validate chart
```

---

## Popular Helm Charts

| Chart | Purpose | Install |
|-------|---------|---------|
| **bitnami/nginx** | Web server | `helm install nginx bitnami/nginx` |
| **bitnami/postgresql** | Database | `helm install pg bitnami/postgresql` |
| **prometheus-community/prometheus** | Monitoring | `helm install prom prometheus-community/prometheus` |
| **grafana/grafana** | Dashboards | `helm install grafana grafana/grafana` |
| **ingress-nginx** | Ingress controller | `helm install ingress ingress-nginx/ingress-nginx` |
| **cert-manager** | TLS certificates | `helm install cm jetstack/cert-manager` |
| **argo/argo-cd** | GitOps | `helm install argocd argo/argo-cd` |

---

## When to Use Helm

```
┌─────────────────────────────────────────────────────────────────────────┐
│                    WHEN TO USE HELM                                      │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   USE HELM WHEN:                      USE PLAIN YAML WHEN:              │
│   ────────────────                    ─────────────────────             │
│   • Complex apps (many resources)     • Simple apps (1-3 files)         │
│   • Multiple environments             • Single environment              │
│   • Installing third-party software   • Learning K8s basics             │
│   • Need versioning & rollback        • Quick experiments               │
│   • Sharing configs across teams      • One-off deployments             │
│   • Managing dependencies             • Understanding raw manifests     │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## Helm vs Kustomize

Both solve the "different environments" problem differently:

| Aspect | Helm | Kustomize |
|--------|------|-----------|
| **Approach** | Templating (Go templates) | Patching (overlays) |
| **Learning curve** | Steeper | Easier |
| **Built into kubectl** | No (separate tool) | Yes (`kubectl apply -k`) |
| **Package distribution** | Yes (chart repos) | No (just files) |
| **Complexity** | Higher | Lower |
| **Best for** | Third-party apps, complex deployments | Simple customization |

---

## Where Helm Fits in This Course

```
┌─────────────────────────────────────────────────────────────────────────┐
│                    HELM IN THIS COURSE                                   │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   Chapter 1-8:  Raw YAML (learn the fundamentals)                       │
│                                                                         │
│   Chapter 9:    Helm install Prometheus + Grafana                       │
│                 (observability stack)                                   │
│                                                                         │
│   Chapter 10:   Helm install AWS Load Balancer Controller               │
│                 (EKS deployment)                                        │
│                                                                         │
│   Chapter 11:   Helm install ArgoCD                                     │
│                 (GitOps)                                                │
│                                                                         │
│   Why this order?                                                       │
│   • Understanding raw YAML makes Helm easier                            │
│   • You can debug Helm charts when things break                         │
│   • You know what's actually being deployed                             │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## Key Takeaways

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         HELM SUMMARY                                     │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  Helm Chart = Packaged, templated K8s YAML bundle                       │
│                                                                         │
│  Key benefits:                                                          │
│  • Reusable configurations across environments                          │
│  • Easy value overrides (--set, -f values.yaml)                         │
│  • Version control & instant rollback                                   │
│  • Huge ecosystem of pre-made charts                                    │
│  • Dependency management                                                │
│                                                                         │
│  Key commands:                                                          │
│  • helm install  - Deploy a chart                                       │
│  • helm upgrade  - Update a release                                     │
│  • helm rollback - Revert to previous version                           │
│  • helm list     - Show installed releases                              │
│                                                                         │
│  Remember:                                                              │
│  • Learn raw YAML first (what we're doing now)                          │
│  • Helm is a tool, not a requirement                                    │
│  • We'll use it in later chapters                                       │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## Related

- [1.2 Pod YAML Anatomy](1.2_pod_yaml_anatomy.md) — Understanding raw K8s manifests first

---

*Discussion for Chapter 1 of Kubernetes 101: From Zero to Production*
