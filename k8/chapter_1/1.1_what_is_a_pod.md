# 1.1 What is a Pod?

> The smallest deployable unit in Kubernetes — and it's NOT a container

---

## The Big Idea

```
┌─────────────────────────────────────────────────────────────┐
│                     KUBERNETES NODE                         │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   ┌─────────────────────┐    ┌─────────────────────┐        │
│   │        POD 1        │    │        POD 2        │        │
│   │  ┌───────────────┐  │    │  ┌───────────────┐  │        │
│   │  │   Container   │  │    │  │   Container   │  │        │
│   │  │    (nginx)    │  │    │  │   (backend)   │  │        │
│   │  └───────────────┘  │    │  └───────────────┘  │        │
│   │                     │    │                     │        │
│   │  IP: 10.244.0.5     │    │  IP: 10.244.0.6     │        │
│   └─────────────────────┘    └─────────────────────┘        │
│                                                             │
│   Each pod gets its own IP address                          │
│   Containers INSIDE a pod share that IP                     │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

**Key insight:** Kubernetes doesn't manage containers directly. It manages **Pods**, which wrap containers.

---

## Why Pods Instead of Containers?

### The Problem Pods Solve

Some applications need multiple processes that work closely together:

```
Example: Web app + Log shipper

┌─────────────────────────────────────────┐
│                  POD                    │
│  ┌─────────────┐    ┌─────────────┐     │
│  │    nginx    │    │   fluentd   │     │
│  │  (main app) │    │ (log shipper)│    │
│  └──────┬──────┘    └──────┬──────┘     │
│         │                  │            │
│         ▼                  ▼            │
│    ┌────────────────────────────┐       │
│    │     Shared Volume          │       │
│    │   /var/log/nginx           │       │
│    └────────────────────────────┘       │
│                                         │
│  Both containers share:                 │
│  - Same network (localhost works)       │
│  - Same storage volumes                 │
│  - Same lifecycle (start/stop together) │
└─────────────────────────────────────────┘
```

Without pods, you'd need complex orchestration to:
- Start containers together
- Give them shared networking
- Mount the same volumes
- Handle failures as a unit

**Pods solve this by being a "logical host"** — like a tiny VM that contains your containers.

---

## What Containers in a Pod Share

| Resource | Shared? | Details |
|----------|---------|---------|
| **Network** | Yes | Same IP, same ports, localhost works between containers |
| **Storage** | Yes | Via explicitly defined volumes |
| **PID namespace** | Optional | Can share process namespace (see processes in other containers) |
| **Hostname** | Yes | All containers see same hostname |
| **IPC** | Yes | Can use shared memory, semaphores |

---

## Single vs Multi-Container Pods

### Single-Container Pod (Most Common)

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: simple-pod
spec:
  containers:
    - name: nginx
      image: nginx:1.25
```

**Use case:** 90% of your pods. One application per pod.

### Multi-Container Pod (Sidecar Pattern)

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: app-with-sidecar
spec:
  containers:
    # Main application
    - name: app
      image: myapp:1.0
      volumeMounts:
        - name: logs
          mountPath: /var/log/app

    # Sidecar: ships logs to central system
    - name: log-shipper
      image: fluentd:latest
      volumeMounts:
        - name: logs
          mountPath: /var/log/app

  volumes:
    - name: logs
      emptyDir: {}
```

**Common sidecar patterns:**
- Log collection (fluentd, filebeat)
- Proxy/service mesh (envoy, istio-proxy)
- Secrets sync (vault-agent)
- Monitoring (prometheus exporter)

---

## Pod vs Container: Key Differences

| Aspect | Container | Pod |
|--------|-----------|-----|
| **What it is** | Single process/app | Wrapper for 1+ containers |
| **IP Address** | Shares pod's IP | Gets unique IP |
| **Scheduling** | N/A | Scheduled to a node |
| **Lifecycle** | Managed by pod | Managed by Kubernetes |
| **Direct creation** | No (in K8s) | Yes, but use Deployments |

---

## Pod Anatomy Deep Dive

```
┌────────────────────────────────────────────────────────────────┐
│                           POD                                  │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│  metadata:                                                     │
│  ├── name: my-pod              # Unique identifier             │
│  ├── namespace: default        # Isolation boundary            │
│  ├── labels: {app: web}        # For selection/grouping        │
│  └── annotations: {...}        # Non-identifying metadata      │
│                                                                │
│  spec:                                                         │
│  ├── containers: [...]         # Your application(s)          │
│  ├── initContainers: [...]     # Run before main containers   │
│  ├── volumes: [...]            # Storage definitions          │
│  ├── restartPolicy: Always     # What to do on failure        │
│  └── nodeSelector: {...}       # Where to schedule            │
│                                                                │
│  status: (managed by K8s)                                      │
│  ├── phase: Running            # Current state                │
│  ├── podIP: 10.244.0.5         # Assigned IP                  │
│  └── containerStatuses: [...]  # Per-container status         │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

---

## Hands-On: Create Your First Pod

### Step 1: Create the manifest

```bash
cat << 'EOF' > my-first-pod.yaml
apiVersion: v1
kind: Pod
metadata:
  name: my-first-pod
  labels:
    app: hello
spec:
  containers:
    - name: nginx
      image: nginx:1.25
      ports:
        - containerPort: 80
EOF
```

### Step 2: Apply it

```bash
kubectl apply -f my-first-pod.yaml
```

### Step 3: Verify

```bash
# Check pod status
kubectl get pods

# Output:
# NAME           READY   STATUS    RESTARTS   AGE
# my-first-pod   1/1     Running   0          10s
```

### Step 4: Explore

```bash
# See detailed info
kubectl describe pod my-first-pod

# Get the pod's IP
kubectl get pod my-first-pod -o wide

# Shell into the container
kubectl exec -it my-first-pod -- /bin/sh

# Inside the pod, test nginx
curl localhost:80
exit
```

### Step 5: Clean up

```bash
kubectl delete pod my-first-pod
```

---

## Common Misconceptions

### ❌ "A pod is just a container"
**Reality:** A pod is a wrapper that can contain multiple containers sharing resources.

### ❌ "I should put my entire app stack in one pod"
**Reality:** One pod = one logical application unit. Frontend and backend should be separate pods.

### ❌ "Pods are reliable and long-lived"
**Reality:** Pods are ephemeral. They can be killed anytime. Use Deployments for reliability.

### ❌ "I can update a running pod"
**Reality:** Pods are immutable. To change config, delete and recreate (Deployments handle this).

---

## When to Use Multiple Containers in a Pod

**DO use multiple containers when:**
- Containers are tightly coupled (can't function alone)
- They need to share files via volume
- They need localhost communication
- One is a helper for the other (sidecar pattern)

**DON'T use multiple containers when:**
- They can scale independently
- They have different lifecycles
- They could run on different nodes
- They're separate services (use separate pods + Services)

---

## Key Takeaways

1. **Pod = atomic unit** — Kubernetes schedules, scales, and manages pods
2. **Containers share resources** — Network, storage, lifecycle within a pod
3. **One app per pod** — Most pods have a single container
4. **Pods are ephemeral** — Design for pods being killed and recreated
5. **Don't use bare pods** — Use Deployments for production workloads

---

## Next Up

[1.2 Pod YAML Anatomy](1.2_pod_yaml_anatomy.md) — Deep dive into writing pod manifests

---

*Chapter 1.1 of Kubernetes 101: From Zero to Production*
